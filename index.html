<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reynarz | Portfolio</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/carousel.css">
    <link rel="stylesheet" href="css/grid.css">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dosis&family=Raleway&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+HK:wght@200..900&family=Sen:wght@400..800&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.png">
</head>
<body>

<!-- Slide-in box with fading iframe -->
<div class="slide-box">
  <button id="closeBtn" class="close-btn">Ã—</button>
    
      <!-- ðŸ”µ Loader -->
  <div id="loader" class="loader">
    <div class="loader-bar"></div>
    <div class="loader-dots" aria-hidden="true">
      <span></span><span></span><span></span>
    </div>
  </div>
  <iframe id="contentFrame" src="" style="width: 100%; height: 100%; border: none;"></iframe>
</div>

<style>
    .loader {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 2px;               /* requested height */
  z-index: 10002;            /* above close btn (10001) */
  pointer-events: none;
  display: none;             /* shown when .active */
}
.loader.active { display: block; }

/* Progress mode (bar) */
.loader-bar {
  position: absolute;
  top: 0;
  left: 0;
  height: 2px;               /* requested height */
  width: 2%;                 /* requested width */
  background: #fff;
  transform: translateX(0%); /* we move this 0 -> 98% */
  transition: transform 0.12s linear;
}
/* Hide the bar when using dots fallback */
.loader.dots .loader-bar { display: none; }

/* Dots fallback (3 mini-bars) */
.loader-dots {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 2px;
  display: none;             /* shown when .dots */
  gap: 2px;                  /* requested spacing */
}
.loader.dots .loader-dots { display: flex; }
.loader-dots span {
  height: 2px;               /* requested height */
  width: 30px;               /* small mini-bar width */
  background: #fff;
  opacity: 0;
}
    
.slide-box {
  position: fixed;
  top: 0;
  right: -100%; /* Start fully off-screen to the right */
  width: calc(100% - 300px); /* Leave space for the 300px sidebar */
  height: 100vh;
  background-color: black;
  transition: right 0.5s ease;
  z-index: 9999;
}
@media (max-width: 1024px) {
  .slide-box { width: 100%; }
}
.slide-box.show { right: 0; }

.slide-box iframe {
  width: 100%;
  height: 100%;
  border: none;
  opacity: 1;
  transition: opacity 0.6s ease;
}

.close-btn {
  position: absolute;
  top: 10px;
  left: 30px;
  background: transparent;
  border: none;
  font-size: 60px;
  color: white;
  cursor: pointer;
  z-index: 10001;
  transform: rotate(0deg) scale(1);
  transition: transform 0.24s ease-out, color 0.24s ease;
  padding: 20px;
}
.close-btn:hover {
  color: #FFFFFF90;
  transform: scale(0.9);
}
</style>

<div class="container">

  <div class="mobile-header">
    <div class="mobile-header-top">
      <div class="home-button">
        <a href="#">REYNARZ</a>
      </div>
      <div class="hamburger-container">
        <button class="hamburger" onclick="toggleMobileMenu()">â˜°</button>
      </div>
    </div>
    <div id="mobile-menu" class="mobile-menu">
      <a href="#" data-file="resume-page.html"><i class="fas fa-file-alt"></i>RESUMe</a>
      <a href="#" data-file="coverletter.html"><i class="fa-solid fa-envelope"></i>COVER LETTER</a>
      <hr class="sidebar-divider">
      <a href="https://www.linkedin.com/in/reynardoperez" target="_blank"><i class="fa-brands fa-linkedin-in"></i>LinkedIn</a>
      <a href="https://github.com/reynarzz" target="_blank"><i class="fa-solid fa-code-branch"></i>GitHub</a>
      <a href="https://www.youtube.com/channel/UCYxGHl-M49FFuR5YyndAYgw" target="_blank"><i class="fa-brands fa-youtube"></i>Youtube</a>
    </div>
  </div>

  <!-- ðŸ”´ Sidebar -->
  <aside class="sidebar">
    <div class="profile-section">
      <img src="assets/images/profile.png" alt="Profile Picture" class="profile-pic">
      <h2 class="name">Reynardo PÃ©rez</h2>
    </div>

    <div class="sidebar-links">
      <a href="#" data-file="resume-page.html"><i class="fas fa-file-alt"></i>RESUMe</a>
      <a href="#" data-file="coverletter.html"><i class="fa-solid fa-envelope"></i>COVER LETTER</a>
      <hr class="sidebar-divider">
      <div class="social-buttons">
        <a href="https://www.linkedin.com/in/reynardoperez" target="_blank" class="social-btn"><i class="fa-brands fa-linkedin-in"></i>LinkedIn</a>
        <a href="https://github.com/reynarzz" target="_blank" class="social-btn"><i class="fa-solid fa-code-branch"></i>GitHub</a>
        <a href="https://www.youtube.com/channel/UCYxGHl-M49FFuR5YyndAYgw" target="_blank" class="social-btn"><i class="fa-brands fa-youtube"></i>Youtube</a>
      </div>
    </div>

    <div class="intro">
      <strong>HELLO, WELCOME!</strong>
      <p class="intro-text">
        My name is Reynardo Perez (Reynarz) Iâ€™m a gameplay, tools programmer! <br>Here you can see some of my personal projects.
      </p>
    </div>
    <div class="social-icons"></div>
  </aside>

  <!-- ðŸŸ¦ Main Content Area -->
  <main class="main-content">
    <!-- ðŸŸ¡ Top Nav (currently commented out) -->

    <!-- Video section -->
    <section class="video-section">
      <div class="video-carousel">
        <div class="carousel-track">

          <div class="video-wrapper" data-file="broken-path-explore.html" data-button="View More">
            <video 
              playsinline 
              webkit-playsinline 
              muted 
              class="carousel-video active" 
              poster="assets/images/brokenVideoWait.png" 
              preload="none">
            </video>
            <div class="video-overlay"></div>
            <div class="video-gradient-overlay"></div>
            <div class="video-text title">Broken Path</div>
            <div class="video-text subtitle">My Pixel Art video game being made with Unity3D.</div>
          </div>

          <div class="video-wrapper" data-file="mino-explore.html" data-button="View More">
            <video 
              playsinline 
              webkit-playsinline 
              muted 
              class="carousel-video" 
              poster="assets/images/minoVideoWait.png" 
              preload="none">
            </video>
            <div class="video-text title">Mino's Adventure</div>
            <div class="video-text subtitle">3D Platformer (PC-Mobile) made with Unity3D</div>
          </div>

          <div class="video-wrapper" data-file="shred-engine-explore.html" data-button="View More">
            <video 
              playsinline 
              webkit-playsinline 
              muted 
              class="carousel-video" 
              poster="assets/images/engineVideoWait.png" 
              preload="none">
            </video>
            <div class="video-overlay"></div>
            <div class="video-gradient-overlay"></div>
            <div class="video-text title">SHRED ENGINE</div>
            <div class="video-text subtitle">My custom 3D/2D game engine made with C++, Jolt physics, Box2D, and own renderer.</div>
          </div>

          <div class="video-wrapper">
            <video 
              playsinline 
              webkit-playsinline 
              muted 
              class="carousel-video" 
              poster="assets/images/MinoToolVideoWait.png" 
              preload="none">
            </video>
            <div class="video-overlay"></div>
            <div class="video-gradient-overlay"></div>
            <div class="video-text title">Mino tool</div>
            <div class="video-text subtitle">My C# custom library to create powerful graphics tools. OpenGL, Custom renderer.</div>
          </div>

          <div class="video-wrapper">
            <video playsinline webkit-playsinline muted class="carousel-video" src="assets/videos/navecita.mp4" autoplay muted loop></video>
            <div class="video-overlay"></div>
            <div class="video-gradient-overlay"></div>
            <div class="video-text title">Navecita</div>
            <div class="video-text subtitle">Game made from scratch, C++ + OpenGL</div>
          </div>

          <div class="video-wrapper">
            <video playsinline webkit-playsinline muted class="carousel-video" src="assets/videos/shder3d.mp4" autoplay muted loop></video>
            <div class="video-overlay"></div>
            <div class="video-gradient-overlay"></div>
            <div class="video-text title">Shder3D</div>
            <div class="video-text subtitle">3D GLSL shader editor for Android, made with Kotlin and OpenGL ES 2.0.</div>
          </div>

          <button class="carousel-arrow left">
            <!-- Left Arrow -->
            <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="12" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6" />
            </svg>
          </button>

          <button class="carousel-arrow right">
            <!-- Right Arrow -->
            <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 6 15 12 9 18" />
            </svg>
          </button>
        </div>

        <!-- <header class="top-nav">...</header> -->

        <footer class="video-footer-text">
          <div class="video-title"></div>
          <div class="video-subtitle"></div>
          <a href="#" class="footer-button" target="_blank" rel="noopener noreferrer" data-file="broken-path-explore.html">
            View more
          </a>
        </footer>
      </div>
    </section>

    <section class="grid-section">
      <div class="grid-container">
        <a href="#" class="grid-item" data-file="broken-path-explore.html">
          <img src="assets/images/01-01.jpg" alt="Image 1" loading="eager"/>
          <div class="overlay">
            <h3 class="title">BROKEN PATH</h3>
            <p class="hashtags">#Unity3D #Game</p>
          </div>
        </a>

        <a href="#" class="grid-item" data-file="mino-explore.html">
          <img src="assets/images/minogrid3.png"  alt="Image 2" loading="eager"/>
          <div class="overlay">
            <h3 class="title">Mino's Adventure</h3>
            <p class="hashtags">#Unity3D #Platformer #Solo-project</p>
          </div>
        </a>

        <a href="#" class="grid-item" data-file="shred-engine-explore.html">
          <img src="assets/images/engine5.png" alt="Image 2" loading="eager"/>
          <div class="overlay">
            <h3 class="title">Shred Engine</h3>
            <p class="hashtags">#Engine #C++ #Jolt #Renderer</p>
          </div>
        </a>

        <a href="#" class="grid-item">
          <img src="assets/images/02-01.jpg" alt="Image 3" loading="eager"/>
          <div class="overlay">
            <h3 class="title">Mino Tool</h3>
            <p class="hashtags">#OpenGL #CSharp #DearImGui</p>
          </div>
        </a>

        <a href="#" class="grid-item">
          <img src="assets/images/04-01.png" alt="Image 4" loading="eager"/>
          <div class="overlay">
            <h3 class="title">Navecita</h3>
            <p class="hashtags">#C++ #OpenGL</p>
          </div>
        </a>

        <a href="#" class="grid-item">
          <img src="assets/images/sh3dpic.jpg" alt="Image 5" loading="eager"/>
          <div class="overlay">
            <h3 class="title">Shder3D</h3>
            <p class="hashtags">#Kotlin #OpenGLES #Editor</p>
          </div>
        </a>

        <a href="#" class="grid-item">
          <img src="assets/images/03-01.jpg" alt="Image 6" loading="eager"/>
          <div class="overlay">
            <h3 class="title">Minity</h3>
            <p class="hashtags">#Unity3D #Native plugin #Renderer</p>
          </div>
        </a>

        <a href="#" class="grid-item">
          <img src="assets/images/05-01.png" alt="Image 7" loading="eager"/>
          <div class="overlay">
            <h3 class="title">U Talk</h3>
            <p class="hashtags">#Unity3D #Asset #Tool</p>
          </div>
        </a>
      </div>
    </section>
  </main>
</div>

<script>
/* ===========================
   Carousel / Footer Text
   =========================== */
const videos = document.querySelectorAll(".carousel-video");
let current = 0;
let interval = setInterval(nextVideo, 12000);

const footer = document.querySelector('.video-footer-text');
const titleEl = footer.querySelector('.video-title');
const subtitleEl = footer.querySelector('.video-subtitle');
const buttonEl = footer.querySelector('.footer-button');

let fadeTimeouts = [];

function clearFadeTimeouts() {
  fadeTimeouts.forEach(t => clearTimeout(t));
  fadeTimeouts = [];
}

function fadeOutTexts(callback) {
  titleEl.classList.remove('visible');
  subtitleEl.classList.remove('visible');
  buttonEl.classList.remove('visible');
  buttonEl.style.pointerEvents = 'none';

  // Wait for fade out transition duration (0.5s)
  fadeTimeouts.push(setTimeout(() => {
    if (callback) callback();
  }, 500));
}

function fadeInTexts(title, subtitle, vidWrapper, file) {
  titleEl.textContent = title;
  subtitleEl.textContent = subtitle;

  // Fade in title after 1 second delay
  fadeTimeouts.push(setTimeout(() => {
    titleEl.classList.add('visible');
  }, 1000));

  // Fade in subtitle 600ms after title fade in starts
  fadeTimeouts.push(setTimeout(() => {
    subtitleEl.classList.add('visible');
  }, 1600));

  // Fade in button shortly after
  fadeTimeouts.push(setTimeout(() => {
    buttonEl.classList.add('visible');

    const buttonText = vidWrapper.getAttribute('data-button');

    if (buttonText && buttonText.trim().toLowerCase() !== 'none') {
      buttonEl.textContent = buttonText;
      if (file) {
        buttonEl.setAttribute('data-file', file);
        buttonEl.style.pointerEvents = 'auto';
      } else {
        buttonEl.removeAttribute('data-file');
        buttonEl.style.pointerEvents = 'none';
      }
      buttonEl.style.backgroundColor = 'white';
      buttonEl.style.color = 'black';
      buttonEl.style.border = '1px solid #ccc';
    } else {
      buttonEl.textContent = 'Coming soon';
      buttonEl.removeAttribute('data-file');
      buttonEl.style.pointerEvents = 'none';
      buttonEl.style.backgroundColor = 'transparent';
      buttonEl.style.color = 'white';
      buttonEl.style.border = '1px solid white';
    }
  }, 2300));
}

function updateFooterText(video) {
  clearFadeTimeouts();

  const wrapper = video.closest('.video-wrapper');
  const title = wrapper.querySelector('.video-text.title').textContent;
  const subtitle = wrapper.querySelector('.video-text.subtitle').textContent;
  const file = wrapper.getAttribute('data-file');

  fadeOutTexts(() => {
    fadeInTexts(title, subtitle, wrapper, file);
  });

  if (file) {
    buttonEl.setAttribute('data-file', file);
  } else {
    buttonEl.removeAttribute('data-file');
  }
}

function nextVideo() {
  videos[current].classList.remove("active");
  current = (current + 1) % videos.length;
  videos[current].classList.add("active");
  videos[current].currentTime = 0;  // reset to start
  videos[current].play().catch(()=>{});
  updateFooterText(videos[current]);
}

function prevVideo() {
  videos[current].classList.remove("active");
  current = (current - 1 + videos.length) % videos.length;
  videos[current].classList.add("active");
  videos[current].currentTime = 0;  // reset to start
  videos[current].play().catch(()=>{});
  updateFooterText(videos[current]);
}

document.querySelector(".carousel-arrow.right").addEventListener("click", () => {
  clearInterval(interval);
  nextVideo();
  interval = setInterval(nextVideo, 12000);
});

document.querySelector(".carousel-arrow.left").addEventListener("click", () => {
  clearInterval(interval);
  prevVideo();
  interval = setInterval(nextVideo, 12000);
});

/* ===========================
   General Layout behaviors
   =========================== */
document.addEventListener('DOMContentLoaded', () => {
  const sidebar = document.querySelector('.sidebar');
  const mainContent = document.querySelector('.main-content');
  const activeVideo = document.querySelector('.carousel-video.active');
  if (activeVideo) updateFooterText(activeVideo);

  // Scroll sidebar wheel -> main content
  if (sidebar && mainContent) {
    sidebar.addEventListener('wheel', (e) => {
      e.preventDefault();
      mainContent.scrollTop += e.deltaY;
    }, { passive: false });
  }

  const nav = document.querySelector(".top-nav");
  const scrollTarget = document.querySelector(".main-content");
  if (nav && scrollTarget) {
    scrollTarget.addEventListener("scroll", function () {
      const scrollThreshold = 100;
      if (scrollTarget.scrollTop > scrollThreshold) {
        nav.classList.add("scrolled");
      } else {
        nav.classList.remove("scrolled");
      }
    });
  }

  const gridContainer = document.querySelector('.grid-container');
  if (mainContent) clampScroll(mainContent);
  if (document.querySelector('.slide-box')) clampScroll(document.querySelector('.slide-box'));
  if (gridContainer && gridContainer.scrollHeight > gridContainer.clientHeight) clampScroll(gridContainer);
});

/* ===========================
   Slide-box open/close (Unified)
   =========================== */
const slideBox = document.querySelector('.slide-box');
const iframe = document.getElementById('contentFrame');
const closeBtn = document.getElementById('closeBtn');

let currentFile = "";
let iframeLoadRequestId = 0; // prevent race conditions
let isSlideBoxBusy = false;

    /* ===== Loader helpers ===== */
let dotsTimer = null;
let currentAbortController = null;

function showLoader(mode = 'bar') {
  const el = document.getElementById('loader');
  if (!el) return;
  el.classList.add('active');
  if (mode === 'dots') {
    el.classList.add('dots');
    startDots();
  } else {
    el.classList.remove('dots');
    stopDots();
  }
}

function hideLoader() {
  stopDots();
  const el = document.getElementById('loader');
  if (el) el.classList.remove('active');
}

function setLoaderProgress(pct) {
  const clamped = Math.max(0, Math.min(1, pct || 0));
  const bar = document.querySelector('#loader .loader-bar');
  if (!bar) return;
  // 2% bar travels across; keep fully visible -> max 98%
  const x = clamped * 98;
  bar.style.transform = `translateX(${x}%)`;
}

function startDots() {
  stopDots();
  const spans = document.querySelectorAll('#loader .loader-dots span');
  if (!spans.length) return;
  // Steps: 0: show 1, 1: show 1-2, 2: show 1-3, 3: hide all, repeat
  let step = 0;
  dotsTimer = setInterval(() => {
    if (step === 0) { spans.forEach(s => s.style.opacity = 0); spans[0].style.opacity = 1; }
    else if (step === 1) { spans[1].style.opacity = 1; }
    else if (step === 2) { spans[2].style.opacity = 1; }
    else if (step === 3) { spans.forEach(s => s.style.opacity = 0); }
    step = (step + 1) % 4;
  }, 200); // requested 0.2s cadence
}

function stopDots() {
  if (dotsTimer) {
    clearInterval(dotsTimer);
    dotsTimer = null;
  }
}

/* Inject a <base> into the HTML so relative URLs inside srcdoc resolve. */
function injectBaseTag(html, baseHref) {
  if (/<base\s/i.test(html)) return html;
  if (/<head[^>]*>/i.test(html)) {
    return html.replace(/<head([^>]*)>/i, `<head$1><base href="${baseHref}">`);
  }
  // ensure a head exists if missing
  return `<!doctype html><html><head><base href="${baseHref}"></head><body>${html}</body></html>`;
}

/* Load into iframe with progress when possible; fallback to dots + normal src */
async function loadIframeWithProgress(file, requestId) {
  // Cancel any in-flight
  if (currentAbortController) currentAbortController.abort();
  currentAbortController = new AbortController();

  try {
    showLoader('bar');
    setLoaderProgress(0);

    const res = await fetch(file, { signal: currentAbortController.signal, cache: 'no-cache' });
    const total = Number(res.headers.get('Content-Length')) || 0;

    // If we can't measure or stream, use fallback
    if (!res.ok || !res.body || !total) throw new Error('no-measurable-progress');

    const reader = res.body.getReader();
    let received = 0;
    const chunks = [];

    while (true) {
      const { done, value } = await reader.read();
      if (requestId !== iframeLoadRequestId) return; // superseded
      if (done) break;
      chunks.push(value);
      received += value.length;
      setLoaderProgress(received / total);
    }

    // Build full HTML text and inject <base> so assets resolve
    const blob = new Blob(chunks, { type: res.headers.get('Content-Type') || 'text/html' });
    const html = await new Response(blob).text();
    if (requestId !== iframeLoadRequestId) return;

    const baseHref = new URL(file, location.href).href;
    const htmlWithBase = injectBaseTag(html, baseHref);

    // Navigate using srcdoc to avoid refetch and to keep the load event
    iframe.srcdoc = htmlWithBase;
  } catch (err) {
    // Fallback to 3-bar animation and normal navigation
    if (err.name === 'AbortError' || requestId !== iframeLoadRequestId) return;
    showLoader('dots');
    iframe.src = file;
  }
}
    
function openInSlideBox(file) {
  if (!file || isSlideBoxBusy) return;

  // Close mobile menu if open
  const mobileMenu = document.getElementById('mobile-menu');
  if (mobileMenu) mobileMenu.classList.remove('show');

  // Toggle close if same file + already open
  if (slideBox.classList.contains('show') && currentFile === file) {
    slideBox.classList.remove('show');
    iframe.style.opacity = 0;
    hideLoader();
    if (currentAbortController) currentAbortController.abort();
    isSlideBoxBusy = false;
    return;
  }

  const requestId = ++iframeLoadRequestId;
  isSlideBoxBusy = true;

  const attachLoadThenFadeIn = () => {
    iframe.addEventListener('load', () => {
      if (iframeLoadRequestId !== requestId) return;
      requestAnimationFrame(() => {
        iframe.style.opacity = 1;   // fade in iframe
        hideLoader();               // hide loader on load
        isSlideBoxBusy = false;
      });
    }, { once: true });
  };

  if (!slideBox.classList.contains('show')) {
    // Opening from closed state
    slideBox.classList.add('show');
    iframe.style.opacity = 0; // start hidden for fade
    showLoader('bar');        // show loader immediately

    setTimeout(() => {
      if (iframeLoadRequestId !== requestId) return;
      currentFile = file;          // set when actually navigating
      attachLoadThenFadeIn();      // attach before navigation
      loadIframeWithProgress(file, requestId);
    }, 500); // match your slide transition (0.5s)
  } else {
    // Swapping while open: fade out, swap, fade in
    showLoader('bar');
    const onFadeOutEnd = (e) => {
      if (e.propertyName !== 'opacity') return;
      iframe.removeEventListener('transitionend', onFadeOutEnd);
      if (iframeLoadRequestId !== requestId) return;
      currentFile = file;          // set when swapping src
      attachLoadThenFadeIn();      // attach before navigation
      loadIframeWithProgress(file, requestId);
    };
    iframe.addEventListener('transitionend', onFadeOutEnd);
    // trigger fade-out
    requestAnimationFrame(() => { iframe.style.opacity = 0; });
  }
}

// Single, consolidated click handler for ALL [data-file] triggers
document.querySelectorAll('.sidebar-links a[data-file], .mobile-menu a[data-file], .footer-button[data-file], .grid-item[data-file]')
  .forEach(el => {
    el.addEventListener('click', (e) => {
      e.preventDefault();
      const file = el.getAttribute('data-file');
      if (file) openInSlideBox(file);
    });
  });

// Close button (single listener)
if (closeBtn) {
  closeBtn.addEventListener('click', () => {
    iframeLoadRequestId++;        // cancel any pending loads
    if (currentAbortController) currentAbortController.abort();
    hideLoader();
    iframe.style.opacity = 0;
    slideBox.classList.remove('show');
    isSlideBoxBusy = false;
  });
}
// Mobile menu close on link click (non-data-file links)
document.querySelectorAll("#mobile-menu a").forEach(link => {
  link.addEventListener("click", () => {
    const menu = document.getElementById("mobile-menu");
    if (menu) menu.classList.remove("show");
  });
});

function toggleMobileMenu() {
  const menu = document.getElementById("mobile-menu");
  if (menu) menu.classList.toggle("show");
}

/* ===========================
   Misc helpers
   =========================== */
document.querySelectorAll('.grid-container img, .grid-container a').forEach(el => {
  el.addEventListener('dragstart', e => e.preventDefault());
});

function clampScroll(div) {
  div.addEventListener('scroll', () => {
    div.scrollTop = Math.max(1, Math.min(div.scrollTop, div.scrollHeight - div.clientHeight - 1));
  });
}

function clampScrollSmooth(div) {
  div.addEventListener('scroll', () => {
    const maxScroll = div.scrollHeight - div.clientHeight - 1;
    const clamped = Math.max(1, Math.min(div.scrollTop, maxScroll));
    if (div.scrollTop !== clamped) {
      div.scrollTo({ top: clamped, behavior: 'smooth' });
    }
  });
}

/* ===========================
   (Optional) Preloading helpers (guarded)
   =========================== */
async function preloadAsset(href, asType) {
  return new Promise((resolve) => {
    // Avoid duplicating preloads
    if (document.querySelector(`link[rel="preload"][href="${href}"]`)) {
      return resolve();
    }
    const link = document.createElement('link');
    link.rel = 'preload';
    link.href = href;
    link.as = asType;
    link.onload = resolve;
    link.onerror = () => { console.warn(`Failed to preload: ${href}`); resolve(); };
    document.head.appendChild(link);
  });
}

// Parse an iframe HTML and preload its resources
async function preloadIframeResourcesFromHTML(url) {
  try {
    const htmlText = await fetch(url).then(res => res.text());
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlText, 'text/html');

    const preloadList = [];
    doc.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
      const href = link.getAttribute('href');
      if (href) preloadList.push(preloadAsset(href, 'style'));
    });
    doc.querySelectorAll('script[src]').forEach(script => {
      const src = script.getAttribute('src');
      if (src) preloadList.push(preloadAsset(src, 'script'));
    });
    doc.querySelectorAll('img[src]').forEach(img => {
      const src = img.getAttribute('src');
      if (src) preloadList.push(preloadAsset(src, 'image'));
    });

    await Promise.all(preloadList);
  } catch (e) {
    console.error(`Error preloading from ${url}:`, e);
  }
}

// Preload all iframe pages and load one of them (only if you wire a button)
async function preloadAllAndShowIframe() {
  const iframePages = [
    'resume-page.html',
    'coverletter.html',
    'broken-path-explore.html',
    'shred-engine-explore.html'
  ];

  for (const page of iframePages) {
    await preloadIframeResourcesFromHTML(page);
  }

  const i = document.getElementById('contentFrame'); // corrected ID
  if (i) {
    i.src = 'resume-page.html';
    i.style.display = 'block';
  }
}

// Only attach if a button with this id exists
const loadBtn = document.getElementById('loadButton');
if (loadBtn) loadBtn.addEventListener('click', preloadAllAndShowIframe);
</script>

<!-- Hidden iframes to help warm caches -->
<iframe src="resume-page.html" style="display:none;" id="preload1"></iframe>
<iframe src="coverletter.html" style="display:none;" id="preload2"></iframe>

<!-- He is with us, even though we cannot see him -->
<!-- Glory to Jesus Christ! -->
</body>
</html>
